import{r as f,R as P,i as ae,j as s,d as L,b as F,e as $,S as D,k as z,l as Q}from"./index-942bd52f.js";import{a as X,d as oe,P as ie}from"./PageWrapper-99381d86.js";import{J as se,j as ce}from"./JsonSchemaForm-d78752fd.js";/*!
 * react-paypal-js v8.7.0 (2024-09-16T17:52:54.237Z)
 * Copyright 2020-present, PayPal, Inc. All rights reserved.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * https://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var y;(function(e){e.INITIAL="initial",e.PENDING="pending",e.REJECTED="rejected",e.RESOLVED="resolved"})(y||(y={}));var A;(function(e){e.LOADING_STATUS="setLoadingStatus",e.RESET_OPTIONS="resetOptions",e.SET_BRAINTREE_INSTANCE="braintreeInstance"})(A||(A={}));var M;(function(e){e.NUMBER="number",e.CVV="cvv",e.EXPIRATION_DATE="expirationDate",e.EXPIRATION_MONTH="expirationMonth",e.EXPIRATION_YEAR="expirationYear",e.POSTAL_CODE="postalCode"})(M||(M={}));var l=function(){return l=Object.assign||function(t){for(var n,r=1,a=arguments.length;r<a;r++){n=arguments[r];for(var o in n)Object.prototype.hasOwnProperty.call(n,o)&&(t[o]=n[o])}return t},l.apply(this,arguments)};function Z(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(e!=null&&typeof Object.getOwnPropertySymbols=="function")for(var a=0,r=Object.getOwnPropertySymbols(e);a<r.length;a++)t.indexOf(r[a])<0&&Object.prototype.propertyIsEnumerable.call(e,r[a])&&(n[r[a]]=e[r[a]]);return n}function q(e,t,n){if(n||arguments.length===2)for(var r=0,a=t.length,o;r<a;r++)(o||!(r in t))&&(o||(o=Array.prototype.slice.call(t,0,r)),o[r]=t[r]);return e.concat(o||Array.prototype.slice.call(t))}var j="data-react-paypal-script-id",T={DATA_CLIENT_TOKEN:"dataClientToken",DATA_JS_SDK_LIBRARY:"dataJsSdkLibrary",DATA_LIBRARY_VALUE:"react-paypal-js",DATA_NAMESPACE:"dataNamespace",DATA_SDK_INTEGRATION_SOURCE:"dataSdkIntegrationSource",DATA_USER_ID_TOKEN:"dataUserIdToken"},ue="Failed to load the PayPal JS SDK script.",Y="paypal",de="usePayPalScriptReducer must be used within a PayPalScriptProvider";function le(e){return e===void 0&&(e=Y),window[e]}function pe(e){for(var t="",n=0;n<e.length;n++){var r=e[n].charCodeAt(0)*n;e[n+1]&&(r+=e[n+1].charCodeAt(0)*(n-1)),t+=String.fromCharCode(97+Math.abs(r)%26)}return t}function fe(e){var t=e.reactComponentName,n=e.sdkComponentKey,r=e.sdkRequestedComponents,a=r===void 0?"":r,o=e.sdkDataNamespace,i=o===void 0?Y:o,u=n.charAt(0).toUpperCase().concat(n.substring(1)),c="Unable to render <".concat(t," /> because window.").concat(i,".").concat(u," is undefined."),d=typeof a=="string"?a:a.join(",");if(!d.includes(n)){var p=[d,n].filter(Boolean).join();c+=`
To fix the issue, add '`.concat(n,"' to the list of components passed to the parent PayPalScriptProvider:")+"\n`<PayPalScriptProvider options={{ components: '".concat(p,"'}}>`.")}return c}function G(e){var t=e,n=j;t[n];var r=Z(t,[n+""]);return"react-paypal-js-".concat(pe(JSON.stringify(r)))}function H(e){var t=self.document.querySelector("script[".concat(j,'="').concat(e,'"]'));t!=null&&t.parentNode&&t.parentNode.removeChild(t)}function ye(e,t){var n,r;switch(t.type){case A.LOADING_STATUS:return typeof t.value=="object"?l(l({},e),{loadingStatus:t.value.state,loadingStatusErrorMessage:t.value.message}):l(l({},e),{loadingStatus:t.value});case A.RESET_OPTIONS:return H(e.options[j]),l(l({},e),{loadingStatus:y.PENDING,options:l(l((n={},n[T.DATA_SDK_INTEGRATION_SOURCE]=T.DATA_LIBRARY_VALUE,n),t.value),(r={},r[j]="".concat(G(t.value)),r))});case A.SET_BRAINTREE_INSTANCE:return l(l({},e),{braintreePayPalCheckoutInstance:t.value});default:return e}}var ee=f.createContext(null);function ve(e){if(typeof(e==null?void 0:e.dispatch)=="function"&&e.dispatch.length!==0)return e;throw new Error(de)}function te(){var e=ve(f.useContext(ee)),t=l(l({},e),{isInitial:e.loadingStatus===y.INITIAL,isPending:e.loadingStatus===y.PENDING,isResolved:e.loadingStatus===y.RESOLVED,isRejected:e.loadingStatus===y.REJECTED});return[t,e.dispatch]}f.createContext({});var J=function(e){var t,n=e.className,r=n===void 0?"":n,a=e.disabled,o=a===void 0?!1:a,i=e.children,u=e.forceReRender,c=u===void 0?[]:u,d=Z(e,["className","disabled","children","forceReRender"]),p=o?{opacity:.38}:{},v="".concat(r," ").concat(o?"paypal-buttons-disabled":"").trim(),I=f.useRef(null),E=f.useRef(null),w=te()[0],x=w.isResolved,O=w.options,U=f.useState(null),_=U[0],B=U[1],C=f.useState(!0),k=C[0],b=C[1],S=f.useState(null),h=S[1];function m(){E.current!==null&&E.current.close().catch(function(){})}return!((t=E.current)===null||t===void 0)&&t.updateProps&&E.current.updateProps({message:d.message}),f.useEffect(function(){if(x===!1)return m;var g=le(O.dataNamespace);if(g===void 0||g.Buttons===void 0)return h(function(){throw new Error(fe({reactComponentName:J.displayName,sdkComponentKey:"buttons",sdkRequestedComponents:O.components,sdkDataNamespace:O[T.DATA_NAMESPACE]}))}),m;var R=function(N,K){B(K),typeof d.onInit=="function"&&d.onInit(N,K)};try{E.current=g.Buttons(l(l({},d),{onInit:R}))}catch(N){return h(function(){throw new Error("Failed to render <PayPalButtons /> component. Failed to initialize:  ".concat(N))})}return E.current.isEligible()===!1?(b(!1),m):(I.current&&E.current.render(I.current).catch(function(N){I.current===null||I.current.children.length===0||h(function(){throw new Error("Failed to render <PayPalButtons /> component. ".concat(N))})}),m)},q(q([x],c,!0),[d.fundingSource],!1)),f.useEffect(function(){_!==null&&(o===!0?_.disable().catch(function(){}):_.enable().catch(function(){}))},[o,_]),P.createElement(P.Fragment,null,k?P.createElement("div",{ref:I,style:p,className:v}):i)};J.displayName="PayPalButtons";function me(e,t){var n=document.querySelector('script[src="'.concat(e,'"]'));if(n===null)return null;var r=ne(e,t),a=n.cloneNode();if(delete a.dataset.uidAuto,Object.keys(a.dataset).length!==Object.keys(r.dataset).length)return null;var o=!0;return Object.keys(a.dataset).forEach(function(i){a.dataset[i]!==r.dataset[i]&&(o=!1)}),o?n:null}function he(e){var t=e.url,n=e.attributes,r=e.onSuccess,a=e.onError,o=ne(t,n);o.onerror=a,o.onload=r,document.head.insertBefore(o,document.head.firstElementChild)}function ge(e){var t=e.environment,n=t==="sandbox"?"https://www.sandbox.paypal.com/sdk/js":"https://www.paypal.com/sdk/js";delete e.environment,e.sdkBaseUrl&&(n=e.sdkBaseUrl,delete e.sdkBaseUrl);var r=e,a=Object.keys(r).filter(function(u){return typeof r[u]<"u"&&r[u]!==null&&r[u]!==""}).reduce(function(u,c){var d=r[c].toString();return c=Se(c),c.substring(0,4)==="data"||c==="crossorigin"?u.attributes[c]=d:u.queryParams[c]=d,u},{queryParams:{},attributes:{}}),o=a.queryParams,i=a.attributes;return o["merchant-id"]&&o["merchant-id"].indexOf(",")!==-1&&(i["data-merchant-id"]=o["merchant-id"],o["merchant-id"]="*"),{url:"".concat(n,"?").concat(Ee(o)),attributes:i}}function Se(e){var t=function(n,r){return(r?"-":"")+n.toLowerCase()};return e.replace(/[A-Z]+(?![a-z])|[A-Z]/g,t)}function Ee(e){var t="";return Object.keys(e).forEach(function(n){t.length!==0&&(t+="&"),t+=n+"="+e[n]}),t}function ne(e,t){t===void 0&&(t={});var n=document.createElement("script");return n.src=e,Object.keys(t).forEach(function(r){n.setAttribute(r,t[r]),r==="data-csp-nonce"&&n.setAttribute("nonce",t["data-csp-nonce"])}),n}function be(e,t){if(t===void 0&&(t=Promise),re(e,t),typeof document>"u")return t.resolve(null);var n=ge(e),r=n.url,a=n.attributes,o=a["data-namespace"]||"paypal",i=V(o);return a["data-js-sdk-library"]||(a["data-js-sdk-library"]="paypal-js"),me(r,a)&&i?t.resolve(i):Re({url:r,attributes:a},t).then(function(){var u=V(o);if(u)return u;throw new Error("The window.".concat(o," global variable is not available."))})}function Re(e,t){t===void 0&&(t=Promise),re(e,t);var n=e.url,r=e.attributes;if(typeof n!="string"||n.length===0)throw new Error("Invalid url.");if(typeof r<"u"&&typeof r!="object")throw new Error("Expected attributes to be an object.");return new t(function(a,o){if(typeof document>"u")return a();he({url:n,attributes:r,onSuccess:function(){return a()},onError:function(){var i=new Error('The script "'.concat(n,'" failed to load. Check the HTTP status code and response body in DevTools to learn more.'));return o(i)}})})}function V(e){return window[e]}function re(e,t){if(typeof e!="object"||e===null)throw new Error("Expected an options object.");var n=e.environment;if(n&&n!=="production"&&n!=="sandbox")throw new Error('The `environment` option must be either "production" or "sandbox".');if(typeof t<"u"&&typeof t!="function")throw new Error("Expected PromisePonyfill to be a function.")}var Ne=function(e){var t,n=e.options,r=n===void 0?{clientId:"test"}:n,a=e.children,o=e.deferLoading,i=o===void 0?!1:o,u=f.useReducer(ye,{options:l(l({},r),(t={},t[T.DATA_JS_SDK_LIBRARY]=T.DATA_LIBRARY_VALUE,t[T.DATA_SDK_INTEGRATION_SOURCE]=T.DATA_LIBRARY_VALUE,t[j]="".concat(G(r)),t)),loadingStatus:i?y.INITIAL:y.PENDING}),c=u[0],d=u[1];return f.useEffect(function(){if(i===!1&&c.loadingStatus===y.INITIAL)return d({type:A.LOADING_STATUS,value:y.PENDING});if(c.loadingStatus===y.PENDING){var p=!0;return be(c.options).then(function(){p&&d({type:A.LOADING_STATUS,value:y.RESOLVED})}).catch(function(v){console.error("".concat(ue," ").concat(v)),p&&d({type:A.LOADING_STATUS,value:{state:y.REJECTED,message:String(v)}})}),function(){p=!1}}},[c.options,i,c.loadingStatus]),P.createElement(ee.Provider,{value:l(l({},c),{dispatch:d})},a)};function W(){}f.createContext({cardFieldsForm:null,fields:{},registerField:W,unregisterField:W});const Pe="/static/check-image-6eac4439.png",Ae=["paypal"];function Ie(e){const[,t]=te(),n=ae();P.useEffect(()=>{t({type:"setLoadingStatus",value:"pending"});const a=n.listen((o,i)=>{H(G(e.payPalOptions)),a()})},[n,t,e.payPalOptions]);const r=f.useRef({props:e,methods:{createOrder:(a,o)=>r.current.props.payPalCreateOrder(a,o),onApprove:a=>r.current.props.payPalOnApprove(a)}});return r.current.props=e,s.jsx(s.Fragment,{children:Ae.map(a=>s.jsx(J,{fundingSource:a,createOrder:r.current.methods.createOrder,onApprove:r.current.methods.onApprove(a)},a))})}function Ce(){var k;const e=L.useGetRegistrationQuery(),[t]=L.useCreateInitialPaymentMutation(),n=F(),r=$(),[a,o]=P.useState(!1),[i,u]=P.useState(),[c,d]=P.useState(((k=n.paymentStep)==null?void 0:k.serverPricingResults.total)||0),p=X();if(!n.paymentStep)return p("/registration"),null;if(e.isFetching||e.isLoading||!e.data)return s.jsx(D,{});const{paymentStep:v,paymentInfo:I}=n,E=v.serverPricingResults,w=e.data,x=async(b,S)=>{o(!0);const h=`${w.dataSchema.title} payment for ${n.registration.registrant_email}`,m={intent:"CAPTURE",purchase_units:[{amount:{currency_code:"USD",value:c.toString()},description:h,invoice_id:v.registrationUUID,reference_id:v.registrationUUID,custom_id:JSON.stringify(I)}],application_context:{shipping_preference:"NO_SHIPPING"}};return await S.order.create(m)},O=async(b,S)=>{let h="none";try{h=JSON.parse(i==null?void 0:i.deposit).name}catch{}const m={registrationUUID:v.registrationUUID,paymentType:b,paymentData:{type:h,total:c},payPalResponse:S};r(z(m));const g=await t(m);if("error"in g)throw new Error(`error creating payment: ${JSON.stringify(g)}`);const{data:R}=g;r(Q(R)),p("/finished")},U=b=>async(S,h)=>{var g;if(!h||!h.order)return;o(!0);let m="PayPal";b==="card"&&(m="Card");try{const R=await h.order.capture(),N=R.purchase_units&&((g=R.purchase_units[0])==null?void 0:g.custom_id);oe("PayPalOnApprove capture",R,N),O(m,R)}catch{o(!1)}},_=()=>{o(!0),O("Check")},B=({formData:b})=>{try{u(b);const S=JSON.parse(b.deposit);d(ce.apply(S.logic,E))}catch(S){console.error("deposit logic error",S)}};let C=w.payPalOptions;return console.log({payPalOptions:C}),s.jsxs("div",{className:"payment-form",style:a?{pointerEvents:"none"}:void 0,children:[!!a&&s.jsx("div",{className:"payment-disable-overlay",children:s.jsx("div",{children:s.jsx(D,{})})}),s.jsx("h1",{children:"Choose your payment option"}),s.jsxs("h3",{children:["Total: $",(c||0).toFixed(2)]}),v.deposit&&s.jsx(se,{schema:{type:"object",properties:{deposit:{type:"string",...v.deposit}}},uiSchema:{deposit:{"ui:placeholder":"Choose an option"}},onChange:B,formData:i,templateData:{},noHtml5Validate:!0,children:" "}),s.jsx("p",{children:'If you would like to pay by credit card, please select "PayPal", then select "Pay with debit or credit card" in the PayPal window.'}),s.jsxs("button",{onClick:_,className:"payby-check-button",children:[s.jsx("img",{alt:"Check",src:Pe}),"Check"]}),!!C&&s.jsx(Ne,{options:C,deferLoading:!0,children:s.jsx(Ie,{payPalOptions:C,payPalCreateOrder:x,payPalOnApprove:U})})]})}function Te(){const[e]=L.useCreateInitialPaymentMutation(),t=X(),n=F(),r=$(),[a,o]=P.useState(!1),{paymentStep:i}=n;if(!i)return s.jsx(D,{});const u=async()=>{o(!0);const c="none",d={registrationUUID:i.registrationUUID,paymentType:"Check",paymentData:{type:c,total:0},payPalResponse:void 0};r(z(d));const p=await e(d);if("error"in p)throw new Error(`error creating payment: ${JSON.stringify(p)}`);const{data:v}=p;r(Q(v)),o(!1),t("/finished")};return a?s.jsx("div",{className:"payment-disable-overlay",children:s.jsx("div",{children:s.jsx(D,{})})}):s.jsxs("div",{className:"payment-form",style:a?{pointerEvents:"none"}:void 0,children:[s.jsx("h3",{children:"Total: $0"}),s.jsx("button",{onClick:u,className:"payby-check-button",children:"Finish Registration"})]})}function De(){const e=L.useGetRegistrationQuery(),t=F();if(e.isFetching||e.isLoading||!e.data||!t.paymentStep)return s.jsx(D,{});const n=t.paymentStep.serverPricingResults.total||0;return s.jsx(ie,{children:n>0?s.jsx(Ce,{}):s.jsx(Te,{})})}export{De as default};
