import{r as v,R as P,i as ie,j as s,d as F,b as J,e as Q,S as x,g as se,k as X,l as Z}from"./index-5013a17e.js";import{a as Y,P as ce}from"./PageWrapper-d7601acd.js";import{m as ue,J as de,j as le,d as pe,c as fe}from"./JsonSchemaForm-e77ab531.js";/*!
 * react-paypal-js v8.7.0 (2024-09-16T17:52:54.237Z)
 * Copyright 2020-present, PayPal, Inc. All rights reserved.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * https://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var m;(function(e){e.INITIAL="initial",e.PENDING="pending",e.REJECTED="rejected",e.RESOLVED="resolved"})(m||(m={}));var A;(function(e){e.LOADING_STATUS="setLoadingStatus",e.RESET_OPTIONS="resetOptions",e.SET_BRAINTREE_INSTANCE="braintreeInstance"})(A||(A={}));var V;(function(e){e.NUMBER="number",e.CVV="cvv",e.EXPIRATION_DATE="expirationDate",e.EXPIRATION_MONTH="expirationMonth",e.EXPIRATION_YEAR="expirationYear",e.POSTAL_CODE="postalCode"})(V||(V={}));var l=function(){return l=Object.assign||function(t){for(var n,r=1,a=arguments.length;r<a;r++){n=arguments[r];for(var o in n)Object.prototype.hasOwnProperty.call(n,o)&&(t[o]=n[o])}return t},l.apply(this,arguments)};function H(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(e!=null&&typeof Object.getOwnPropertySymbols=="function")for(var a=0,r=Object.getOwnPropertySymbols(e);a<r.length;a++)t.indexOf(r[a])<0&&Object.prototype.propertyIsEnumerable.call(e,r[a])&&(n[r[a]]=e[r[a]]);return n}function W(e,t,n){if(n||arguments.length===2)for(var r=0,a=t.length,o;r<a;r++)(o||!(r in t))&&(o||(o=Array.prototype.slice.call(t,0,r)),o[r]=t[r]);return e.concat(o||Array.prototype.slice.call(t))}var U="data-react-paypal-script-id",C={DATA_CLIENT_TOKEN:"dataClientToken",DATA_JS_SDK_LIBRARY:"dataJsSdkLibrary",DATA_LIBRARY_VALUE:"react-paypal-js",DATA_NAMESPACE:"dataNamespace",DATA_SDK_INTEGRATION_SOURCE:"dataSdkIntegrationSource",DATA_USER_ID_TOKEN:"dataUserIdToken"},ye="Failed to load the PayPal JS SDK script.",ee="paypal",ve="usePayPalScriptReducer must be used within a PayPalScriptProvider";function me(e){return e===void 0&&(e=ee),window[e]}function he(e){for(var t="",n=0;n<e.length;n++){var r=e[n].charCodeAt(0)*n;e[n+1]&&(r+=e[n+1].charCodeAt(0)*(n-1)),t+=String.fromCharCode(97+Math.abs(r)%26)}return t}function ge(e){var t=e.reactComponentName,n=e.sdkComponentKey,r=e.sdkRequestedComponents,a=r===void 0?"":r,o=e.sdkDataNamespace,i=o===void 0?ee:o,u=n.charAt(0).toUpperCase().concat(n.substring(1)),c="Unable to render <".concat(t," /> because window.").concat(i,".").concat(u," is undefined."),d=typeof a=="string"?a:a.join(",");if(!d.includes(n)){var y=[d,n].filter(Boolean).join();c+=`
To fix the issue, add '`.concat(n,"' to the list of components passed to the parent PayPalScriptProvider:")+"\n`<PayPalScriptProvider options={{ components: '".concat(y,"'}}>`.")}return c}function K(e){var t=e,n=U;t[n];var r=H(t,[n+""]);return"react-paypal-js-".concat(he(JSON.stringify(r)))}function te(e){var t=self.document.querySelector("script[".concat(U,'="').concat(e,'"]'));t!=null&&t.parentNode&&t.parentNode.removeChild(t)}function Se(e,t){var n,r;switch(t.type){case A.LOADING_STATUS:return typeof t.value=="object"?l(l({},e),{loadingStatus:t.value.state,loadingStatusErrorMessage:t.value.message}):l(l({},e),{loadingStatus:t.value});case A.RESET_OPTIONS:return te(e.options[U]),l(l({},e),{loadingStatus:m.PENDING,options:l(l((n={},n[C.DATA_SDK_INTEGRATION_SOURCE]=C.DATA_LIBRARY_VALUE,n),t.value),(r={},r[U]="".concat(K(t.value)),r))});case A.SET_BRAINTREE_INSTANCE:return l(l({},e),{braintreePayPalCheckoutInstance:t.value});default:return e}}var ne=v.createContext(null);function Ee(e){if(typeof(e==null?void 0:e.dispatch)=="function"&&e.dispatch.length!==0)return e;throw new Error(ve)}function re(){var e=Ee(v.useContext(ne)),t=l(l({},e),{isInitial:e.loadingStatus===m.INITIAL,isPending:e.loadingStatus===m.PENDING,isResolved:e.loadingStatus===m.RESOLVED,isRejected:e.loadingStatus===m.REJECTED});return[t,e.dispatch]}v.createContext({});var M=function(e){var t,n=e.className,r=n===void 0?"":n,a=e.disabled,o=a===void 0?!1:a,i=e.children,u=e.forceReRender,c=u===void 0?[]:u,d=H(e,["className","disabled","children","forceReRender"]),y=o?{opacity:.38}:{},h="".concat(r," ").concat(o?"paypal-buttons-disabled":"").trim(),I=v.useRef(null),b=v.useRef(null),_=re()[0],k=_.isResolved,w=_.options,D=v.useState(null),O=D[0],G=D[1],T=v.useState(!0),L=T[0],g=T[1],N=v.useState(null),p=N[1];function f(){b.current!==null&&b.current.close().catch(function(){})}return!((t=b.current)===null||t===void 0)&&t.updateProps&&b.current.updateProps({message:d.message}),v.useEffect(function(){if(k===!1)return f;var E=me(w.dataNamespace);if(E===void 0||E.Buttons===void 0)return p(function(){throw new Error(ge({reactComponentName:M.displayName,sdkComponentKey:"buttons",sdkRequestedComponents:w.components,sdkDataNamespace:w[C.DATA_NAMESPACE]}))}),f;var S=function(R,j){G(j),typeof d.onInit=="function"&&d.onInit(R,j)};try{b.current=E.Buttons(l(l({},d),{onInit:S}))}catch(R){return p(function(){throw new Error("Failed to render <PayPalButtons /> component. Failed to initialize:  ".concat(R))})}return b.current.isEligible()===!1?(g(!1),f):(I.current&&b.current.render(I.current).catch(function(R){I.current===null||I.current.children.length===0||p(function(){throw new Error("Failed to render <PayPalButtons /> component. ".concat(R))})}),f)},W(W([k],c,!0),[d.fundingSource],!1)),v.useEffect(function(){O!==null&&(o===!0?O.disable().catch(function(){}):O.enable().catch(function(){}))},[o,O]),P.createElement(P.Fragment,null,L?P.createElement("div",{ref:I,style:y,className:h}):i)};M.displayName="PayPalButtons";function be(e,t){var n=document.querySelector('script[src="'.concat(e,'"]'));if(n===null)return null;var r=ae(e,t),a=n.cloneNode();if(delete a.dataset.uidAuto,Object.keys(a.dataset).length!==Object.keys(r.dataset).length)return null;var o=!0;return Object.keys(a.dataset).forEach(function(i){a.dataset[i]!==r.dataset[i]&&(o=!1)}),o?n:null}function Re(e){var t=e.url,n=e.attributes,r=e.onSuccess,a=e.onError,o=ae(t,n);o.onerror=a,o.onload=r,document.head.insertBefore(o,document.head.firstElementChild)}function Pe(e){var t=e.environment,n=t==="sandbox"?"https://www.sandbox.paypal.com/sdk/js":"https://www.paypal.com/sdk/js";delete e.environment,e.sdkBaseUrl&&(n=e.sdkBaseUrl,delete e.sdkBaseUrl);var r=e,a=Object.keys(r).filter(function(u){return typeof r[u]<"u"&&r[u]!==null&&r[u]!==""}).reduce(function(u,c){var d=r[c].toString();return c=Ne(c),c.substring(0,4)==="data"||c==="crossorigin"?u.attributes[c]=d:u.queryParams[c]=d,u},{queryParams:{},attributes:{}}),o=a.queryParams,i=a.attributes;return o["merchant-id"]&&o["merchant-id"].indexOf(",")!==-1&&(i["data-merchant-id"]=o["merchant-id"],o["merchant-id"]="*"),{url:"".concat(n,"?").concat(Ae(o)),attributes:i}}function Ne(e){var t=function(n,r){return(r?"-":"")+n.toLowerCase()};return e.replace(/[A-Z]+(?![a-z])|[A-Z]/g,t)}function Ae(e){var t="";return Object.keys(e).forEach(function(n){t.length!==0&&(t+="&"),t+=n+"="+e[n]}),t}function ae(e,t){t===void 0&&(t={});var n=document.createElement("script");return n.src=e,Object.keys(t).forEach(function(r){n.setAttribute(r,t[r]),r==="data-csp-nonce"&&n.setAttribute("nonce",t["data-csp-nonce"])}),n}function Ie(e,t){if(t===void 0&&(t=Promise),oe(e,t),typeof document>"u")return t.resolve(null);var n=Pe(e),r=n.url,a=n.attributes,o=a["data-namespace"]||"paypal",i=$(o);return a["data-js-sdk-library"]||(a["data-js-sdk-library"]="paypal-js"),be(r,a)&&i?t.resolve(i):Te({url:r,attributes:a},t).then(function(){var u=$(o);if(u)return u;throw new Error("The window.".concat(o," global variable is not available."))})}function Te(e,t){t===void 0&&(t=Promise),oe(e,t);var n=e.url,r=e.attributes;if(typeof n!="string"||n.length===0)throw new Error("Invalid url.");if(typeof r<"u"&&typeof r!="object")throw new Error("Expected attributes to be an object.");return new t(function(a,o){if(typeof document>"u")return a();Re({url:n,attributes:r,onSuccess:function(){return a()},onError:function(){var i=new Error('The script "'.concat(n,'" failed to load. Check the HTTP status code and response body in DevTools to learn more.'));return o(i)}})})}function $(e){return window[e]}function oe(e,t){if(typeof e!="object"||e===null)throw new Error("Expected an options object.");var n=e.environment;if(n&&n!=="production"&&n!=="sandbox")throw new Error('The `environment` option must be either "production" or "sandbox".');if(typeof t<"u"&&typeof t!="function")throw new Error("Expected PromisePonyfill to be a function.")}var Ce=function(e){var t,n=e.options,r=n===void 0?{clientId:"test"}:n,a=e.children,o=e.deferLoading,i=o===void 0?!1:o,u=v.useReducer(Se,{options:l(l({},r),(t={},t[C.DATA_JS_SDK_LIBRARY]=C.DATA_LIBRARY_VALUE,t[C.DATA_SDK_INTEGRATION_SOURCE]=C.DATA_LIBRARY_VALUE,t[U]="".concat(K(r)),t)),loadingStatus:i?m.INITIAL:m.PENDING}),c=u[0],d=u[1];return v.useEffect(function(){if(i===!1&&c.loadingStatus===m.INITIAL)return d({type:A.LOADING_STATUS,value:m.PENDING});if(c.loadingStatus===m.PENDING){var y=!0;return Ie(c.options).then(function(){y&&d({type:A.LOADING_STATUS,value:m.RESOLVED})}).catch(function(h){console.error("".concat(ye," ").concat(h)),y&&d({type:A.LOADING_STATUS,value:{state:m.REJECTED,message:String(h)}})}),function(){y=!1}}},[c.options,i,c.loadingStatus]),P.createElement(ne.Provider,{value:l(l({},c),{dispatch:d})},a)};function z(){}v.createContext({cardFieldsForm:null,fields:{},registerField:z,unregisterField:z});const we="/static/check-image-6eac4439.png",Oe=["paypal"];function _e(e){const[,t]=re(),n=ie();P.useEffect(()=>{t({type:"setLoadingStatus",value:"pending"});const a=n.listen((o,i)=>{te(K(e.payPalOptions)),a()})},[n,t,e.payPalOptions]);const r=v.useRef({props:e,methods:{createOrder:(a,o)=>r.current.props.payPalCreateOrder(a,o),onApprove:a=>r.current.props.payPalOnApprove(a)}});return r.current.props=e,s.jsx(s.Fragment,{children:Oe.map(a=>s.jsx(M,{fundingSource:a,createOrder:r.current.methods.createOrder,onApprove:r.current.methods.onApprove(a)},a))})}function De(){var L;const e=F.useGetRegistrationQuery(),[t]=F.useCreateInitialPaymentMutation(),n=J(),r=Q(),[a,o]=P.useState(!1),[i,u]=P.useState(),[c,d]=P.useState(((L=n.paymentStep)==null?void 0:L.serverPricingResults.total)||0),y=Y();if(!n.paymentStep)return y("/registration"),null;if(e.isFetching||e.isLoading||!e.data)return s.jsx(x,{});const{paymentStep:h,paymentInfo:I}=n,b=h.serverPricingResults,_=e.data,k=async(g,N)=>{o(!0);const p=`${_.dataSchema.title} payment for ${n.registration.registrant_email}`,f={intent:"CAPTURE",purchase_units:[{amount:{currency_code:"USD",value:c.toString()},description:p,invoice_id:h.registrationUUID,reference_id:h.registrationUUID,custom_id:JSON.stringify(I)}],application_context:{shipping_preference:"NO_SHIPPING"}};return await N.order.create(f)},w=({formData:g},N)=>{try{u(g);const p=JSON.parse(g.deposit),f=le.apply(p.logic,N||b);return d(f),f}catch(p){console.error("deposit logic error",p)}},D=async(g,N)=>{var j,q;let p="none",f=c;if((q=(j=e.data)==null?void 0:j.event)!=null&&q.epayment_handling&&g==="Check"){const B=fe(e.data,n.registration,g);i&&(r(se(B)),f=w({formData:i},B))}try{p=JSON.parse(i==null?void 0:i.deposit).name}catch{}const E={registrationUUID:h.registrationUUID,paymentType:g,paymentData:{type:p,total:f},payPalResponse:N};r(X(E));const S=await t(E);if("error"in S)throw new Error(`error creating payment: ${JSON.stringify(S)}`);const{data:R}=S;r(Z(R)),y("/finished")},O=g=>async(N,p)=>{var E;if(!p||!p.order)return;o(!0);let f="PayPal";g==="card"&&(f="Card");try{const S=await p.order.capture(),R=S.purchase_units&&((E=S.purchase_units[0])==null?void 0:E.custom_id);pe("PayPalOnApprove capture",S,R),D(f,S)}catch{o(!1)}},G=()=>{o(!0),D("Check")};let T=_.payPalOptions;return console.log({payPalOptions:T}),s.jsxs("div",{className:"payment-form",style:a?{pointerEvents:"none"}:void 0,children:[!!a&&s.jsx("div",{className:"payment-disable-overlay",children:s.jsx("div",{children:s.jsx(x,{})})}),s.jsx("h1",{children:"Choose your payment option"}),s.jsxs("h3",{children:["Total: ",ue(c)]}),h.deposit&&s.jsx(de,{schema:{type:"object",properties:{deposit:{type:"string",...h.deposit}}},uiSchema:{deposit:{"ui:placeholder":"Choose an option"}},onChange:w,formData:i,templateData:{},noHtml5Validate:!0,children:"Â "}),s.jsx("p",{children:'If you would like to pay by credit card, please select "PayPal", then select "Pay with debit or credit card" in the PayPal window.'}),s.jsxs("button",{onClick:G,className:"payby-check-button",children:[s.jsx("img",{alt:"Check",src:we}),"Check"]}),!!T&&s.jsx(Ce,{options:T,deferLoading:!0,children:s.jsx(_e,{payPalOptions:T,payPalCreateOrder:k,payPalOnApprove:O})})]})}function je(){const[e]=F.useCreateInitialPaymentMutation(),t=Y(),n=J(),r=Q(),[a,o]=P.useState(!1),{paymentStep:i}=n;if(!i)return s.jsx(x,{});const u=async()=>{o(!0);const c="none",d={registrationUUID:i.registrationUUID,paymentType:"Check",paymentData:{type:c,total:0},payPalResponse:void 0};r(X(d));const y=await e(d);if("error"in y)throw new Error(`error creating payment: ${JSON.stringify(y)}`);const{data:h}=y;r(Z(h)),o(!1),t("/finished")};return a?s.jsx("div",{className:"payment-disable-overlay",children:s.jsx("div",{children:s.jsx(x,{})})}):s.jsxs("div",{className:"payment-form",style:a?{pointerEvents:"none"}:void 0,children:[s.jsx("h3",{children:"Total: $0"}),s.jsx("button",{onClick:u,className:"payby-check-button",children:"Finish Registration"})]})}function Le(){const e=F.useGetRegistrationQuery(),t=J();if(e.isFetching||e.isLoading||!e.data||!t.paymentStep)return s.jsx(x,{});const n=t.paymentStep.serverPricingResults.total||0;return s.jsx(ce,{children:n>0?s.jsx(De,{}):s.jsx(je,{})})}export{Le as default};
