# Generated by Django 4.2.1 on 2023-07-02 04:47

from django.db import migrations, models


def recalculate_server_pricing(reg):
    campers = reg.campers.all()

    camper_pricing = reg.server_pricing_results['campers']
    for index, camper in enumerate(campers):
        camper.server_pricing_results = camper_pricing[index]
        camper.save()


def recalc_pricing(apps, schema_editor):
    Registration = apps.get_model('camphoric', 'Registration')
    for registration in Registration.objects.all():
        recalculate_server_pricing(registration)


def backwards(apps, schema_editor):
    pass


class Migration(migrations.Migration):
    dependencies = [
        ('camphoric', '0047_camper_admin_attributes_event_camper_admin_schema'),
    ]

    operations = [
        migrations.AddField(
            model_name='camper',
            name='server_pricing_results',
            field=models.JSONField(null=True),
        ),
        migrations.RunPython(recalc_pricing, backwards),
    ]
